<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –ø–æ —Å–∫–ª–∞–¥–∞–º - Excel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card-custom {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            margin-bottom: 20px;
        }
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            transition: border-color 0.3s;
        }
        .upload-area:hover {
            border-color: #0d6efd;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }
        .filter-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4 text-primary">üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –ø–æ —Å–∫–ª–∞–¥–∞–º</h1>
                <div id="statusArea"></div>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-custom">
                    <div class="card-header">
                        <h5 class="mb-0">üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ Excel</h5>
                    </div>
                    <div class="card-body">
                        <div class="upload-area">
                            <input type="file" id="excelFile" accept=".xlsx,.xls" class="form-control mb-3">
                            <p class="text-muted mb-0">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx) —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–æ–¥–∞–∂–∞—Ö</p>
                            <small class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx, .xls</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div id="filtersSection" class="row mb-4" style="display: none;">
            <div class="col-12">
                <div class="filter-section">
                    <h5 class="mb-3">üîç –§–∏–ª—å—Ç—Ä—ã</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="productFilter" class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–æ–≤–∞—Ä—É:</label>
                            <select id="productFilter" class="form-select" multiple>
                                <option value="">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>
                            </select>
                            <small class="text-muted">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (Cmd) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤</small>
                        </div>
                        <div class="col-md-6">
                            <label for="warehouseFilter" class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ —Å–∫–ª–∞–¥—É:</label>
                            <select id="warehouseFilter" class="form-select" multiple>
                                <option value="">–í—Å–µ —Å–∫–ª–∞–¥—ã</option>
                            </select>
                            <small class="text-muted">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (Cmd) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–∫–ª–∞–¥–æ–≤</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div id="contentSection" style="display: none;">
            <div class="row">
                <!-- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ -->
                <div class="col-lg-6">
                    <div class="card card-custom">
                        <div class="card-header">
                            <h5 class="mb-0">üìà –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ –ø–æ —Å–∫–ª–∞–¥–∞–º</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="warehouseChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ —Å–∫–ª–∞–¥–∞–º–∏ -->
                <div class="col-lg-6">
                    <div class="card card-custom">
                        <div class="card-header">
                            <h5 class="mb-0">üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–∫–ª–∞–¥–∞–º</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>–°–∫–ª–∞–¥</th>
                                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤</th>
                                            <th>–û–±—â–∞—è —Å—É–º–º–∞</th>
                                        </tr>
                                    </thead>
                                    <tbody id="warehouseTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card card-custom">
                        <div class="card-header">
                            <h5 class="mb-0">üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                        </div>
                        <div class="card-body">
                            <div id="detailsContent">
                                <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ —Å–∫–ª–∞–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="text-center text-muted small mt-5">
            –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: <span id="appVersion">‚Äî</span> ¬∑
            <a href="changelog.html" class="link-secondary">–ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π</a>
        </footer>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel -->
    <script>
        // –ó–∞–≥—Ä—É–∂–∞–µ–º XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
        function loadXLSXLibrary() {
            return new Promise((resolve, reject) => {
                if (typeof XLSX !== 'undefined') {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js';
                script.onload = () => {
                    console.log('XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    resolve();
                };
                script.onerror = () => {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ XLSX, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback');
                    // Fallback –¥–ª—è —á—Ç–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—ã—Ö Excel —Ñ–∞–π–ª–æ–≤
                    window.XLSX = {
                        read: function(data, options) {
                            throw new Error('–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ Excel —Ñ–∞–π–ª –≤ CSV —Ñ–æ—Ä–º–∞—Ç');
                        }
                    };
                    reject(new Error('XLSX_NOT_LOADED'));
                };
                document.head.appendChild(script);
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await loadXLSXLibrary();
                console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ');

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const fileInput = document.getElementById('excelFile');
                fileInput.addEventListener('change', handleFileUpload);

                document.getElementById('productFilter').addEventListener('change', applyFilters);
                document.getElementById('warehouseFilter').addEventListener('change', applyFilters);

                showStatus('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª Excel.', 'success');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Excel —Ñ–∞–π–ª –∫–∞–∫ CSV –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞–∑–æ–≤—É—é –≤–µ—Ä—Å–∏—é.', 'error');
            }
        });

        function showStatus(message, type = 'info') {
            const statusArea = document.getElementById('statusArea');
            let statusClass = 'status-success';

            if (type === 'error') {
                statusClass = 'status-error';
            } else if (type === 'warning') {
                statusClass = 'status-warning';
            }

            statusArea.innerHTML = `<div class="status ${statusClass}">${message}</div>`;

            if (type === 'success' || type === 'warning') {
                setTimeout(() => {
                    statusArea.innerHTML = '';
                }, 5000);
            }
        }
    </script>

    <script src="version.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const versionElement = document.getElementById('appVersion');
            if (versionElement && window.APP_VERSION && window.APP_VERSION.current) {
                versionElement.textContent = window.APP_VERSION.current;
            }
        });
    </script>

    <script src="app.js"></script>
</body>
</html>